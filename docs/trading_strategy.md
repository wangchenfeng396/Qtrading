# Qtrading 交易策略说明书 (v2.1 复利版)

## 1. 策略核心：顺势震荡回归 (Trend Mean Reversion)
鉴于 BTC 市场的高波动性，本策略放弃了单纯的均线交叉（容易被来回打损），转而采用**“大周期定势，小周期接飞刀”**的逻辑。

*   **多头**: 1H 趋势向上 + 5m 超卖 + 触底反弹。
*   **空头**: 1H 趋势向下 + 5m 超买 + 冲高回落。

---

## 2. 资金管理 (复利引擎)

### 2.1 仓位模型
*   **本金模式**: **百分比风险模型 (Percentage Risk Model)**
*   **单笔风险**: **2%** (每笔交易最大亏损额为当前账户余额的 2%)
    *   *示例*: 账户 $50 -> 风险 $1.00; 账户 $100 -> 风险 $2.00。
*   **优势**: 盈利时自动加仓（复利），亏损时自动减仓（守财）。

### 2.2 止损与止盈
*   **动态止损 (ATR)**: `ATR(14) * 2.0`。给足市场波动空间，避免被噪音扫出。
*   **高盈亏比**:
    *   **TP1 (1.5R)**: 平仓 50%，推保本。确保落袋为安。
    *   **TP2 (3.5R)**: 平仓剩余，博取单边趋势的大利润。

---

## 3. 入场规则详情

### 3.1 趋势过滤器 (1H Chart)
使用 **EMA 100** 定义牛熊分界：
*   Close > EMA 100 $\rightarrow$ **只做多**
*   Close < EMA 100 $\rightarrow$ **只做空**

### 3.3 离场逻辑 (分批止盈)
*   **TP1 (1.5R)**: 获利达到 1.5R 时，**平仓 50%**。
*   **TP2 (3.5R)**: 获利达到 3.5R 时，**全额清仓**。

### 3.4 订单巡检与风控增强 (Order Guard)
机器人内置了 **订单巡检 (Position Monitor)** 模块，每 5 分钟执行一次全网扫描：

1.  **自动推保本 (Auto Move to BE)**:
    *   **触发条件**: 检测到持有仓位，且挂单中**只剩 1 个限价止盈单**（意味着 TP1 已经成交离场）。
    *   **执行**: 立即撤销原有的止损单，并以**开仓均价**挂出新的止损单。
    *   **目的**: 锁定利润，确保该笔交易最差结果为保本。

2.  **止损补救 (SL Rescue)**:
    *   **触发条件**: 检测到持有仓位，但挂单中**没有任何止损单**（可能是手动误撤或 API 丢包）。
    *   **执行**: 强制在保本位（或原止损位）补挂止损单。
    *   **目的**: 防止裸奔带来的无限风险。

---

## 4. 回测数据验证 (2023-2025)

| 年度 | 净收益 | 核心特征 |
| :--- | :--- | :--- |
| **2023** | **+61.9%** | 震荡上行，稳健获利 |
| **2024** | **+177.0%** | 单边大牛，RSI 回调策略极其精准 |
| **2025** | **+63.4%** | 复杂行情，ATR 止损经受住了考验 |
| **三年总计** | **+302.3%** | **复利增长潜力巨大** |

*(注：以上数据基于固定金额测试，切换为 2% 复利模式后，预期收益将显著高于此数值)*

---

## 5. 实盘部署指南

1.  **配置**: 检查 `src/config.py`，确认 `RISK_PER_TRADE_PCT = 0.02`。
2.  **启动**: `python src/live_bot.py`
3.  **监控**: 关注 Bark/Telegram 推送。